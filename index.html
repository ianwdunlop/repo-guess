<!DOCTYPE html>
<html lang="en">

<head>
    <title>What's your favourite language?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <h3>Hello, enter your github user name and I'll guess your favourite language.</h4>
        <div>
            <input id="username" type="text" placeholder="Github user name" />
            <button onclick="findUser()">Go</button>
        </div>
        <h3 id="favourite-language"></h3>
    </div>
</body>
<script type="text/javascript">
    // Use jQuery, AJAX & JSONP to get user repository details from github
    function findUser() {
        var username = $("#username")[0].value;
        $.ajax({
            url: "https://api.github.com/users/" + username + "/repos?callback=processResponse",
            dataType: 'jsonp',
            jsonpCallback: 'processResponse',
            jsonp: 'callback'
        });
    }

    // Process the github response to find out from the users public 
    // repositories what their favourite language is
    function processResponse(response) {
        // A hash of language to count
        var languages = {};
        // Loop through the repositories and keep track of the language count
        if (response.data.length !== 0) {
            $.each(response.data, function(index, repo) {
                if (!repo.private) {
                    if (repo.language != null) {
                        languages[repo.language] != null ? languages[repo.language] += 1 : languages[repo.language] = 1;
                    }
                }
            });
        }
        // Find the language with the highest repository count
        var highestLanguage = null;
        var highestValue = 0;
        $.each(languages, function(key, value) {
            if (value > highestValue) {
                highestLanguage = key;
                highestValue = value;
            }
        });
        if (highestLanguage != null) {
            $("#favourite-language").html("Your favourite language is <mark>" + highestLanguage + "</mark>");
        } else {
            $("#favourite-language").html("Couldn't find one. Sorry.");
        }
    }
</script>

</html>
